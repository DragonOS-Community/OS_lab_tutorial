<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>文件系统 | 操作系统实验</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Welcome!">
    
    <link rel="preload" href="/OS_lab_tutorial/assets/css/0.styles.dbcc0abd.css" as="style"><link rel="preload" href="/OS_lab_tutorial/assets/js/app.548e512b.js" as="script"><link rel="preload" href="/OS_lab_tutorial/assets/js/2.a10c1015.js" as="script"><link rel="preload" href="/OS_lab_tutorial/assets/js/1.2eb350fb.js" as="script"><link rel="preload" href="/OS_lab_tutorial/assets/js/11.c9b949dd.js" as="script"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/10.9c4a3d6a.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/12.7a6f47e2.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/13.fbdc9172.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/14.75eeae5c.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/15.10230a03.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/16.d211645d.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/17.8aa5ccb7.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/18.f646c752.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/19.2299b1be.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/20.dd2299aa.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/21.54d7136c.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/22.27de1aab.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/23.e6adf6f4.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/24.7144c571.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/25.c03fcfe6.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/26.ffb9fe57.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/27.f7b2825d.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/28.8f03b318.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/29.8cb3c66f.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/3.e8824fe3.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/30.bf9e4276.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/31.8766f540.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/32.6fa5f877.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/33.731649e6.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/34.a3e96ad1.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/35.89bf4f72.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/36.bbc2f5d5.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/37.6b5734d9.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/38.20a388a9.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/39.3226df7c.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/4.0c822be5.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/40.4379c635.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/41.cb39a504.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/42.755dfe9e.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/43.9435c22d.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/44.d3557ca7.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/45.8134401a.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/46.3a14ff68.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/47.4b539e31.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/48.0db8ee20.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/49.d2e78ac9.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/5.fb9e399b.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/50.5b384f99.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/51.a5a622d0.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/52.a05f43bb.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/53.6ecce7af.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/54.1230dd30.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/55.a6f99944.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/56.b6906e64.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/57.c07e7fa9.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/58.44ca2e38.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/59.321c75fa.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/6.1235e1cf.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/60.232b0204.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/61.10b5a74b.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/62.fb27577d.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/63.b9d7de0c.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/64.340bfb3e.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/65.af067ecd.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/66.483873e9.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/7.da280d86.js"><link rel="prefetch" href="/OS_lab_tutorial/assets/js/vendors~docsearch.857e8e87.js">
    <link rel="stylesheet" href="/OS_lab_tutorial/assets/css/0.styles.dbcc0abd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/OS_lab_tutorial/" class="home-link router-link-active"><!----> <span class="site-name">操作系统实验</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/OS_lab_tutorial/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow down"></span></button> <button type="button" aria-label="Linux" class="mobile-dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          实验教程
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab1.html" class="nav-link">
  实验1-熟悉类Linux系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab2.html" class="nav-link">
  实验2-进程创建与进程间通信
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab3/" class="nav-link">
  实验3-进程调度算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab4/" class="nav-link">
  实验4-存储管理算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab5.html" class="nav-link">
  实验5-文件管理系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab6.html" class="nav-link">
  实验6-网络编程(暂定)
</a></li></ul></li><li class="dropdown-item"><h4>
          课程练习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab1.html" class="nav-link">
  实验1-熟悉类Linux系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab2.html" class="nav-link">
  实验2-进程创建与进程间通信
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab3.html" class="nav-link">
  实验3-进程调度算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab4.html" class="nav-link">
  实验4-存储管理算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab5.html" class="nav-link">
  实验5-文件管理系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab6.html" class="nav-link">
  实验6-网络编程(暂定)
</a></li></ul></li><li class="dropdown-item"><h4>
          附录
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab1.html" class="nav-link">
  实验1-熟悉类Linux系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab2.html" class="nav-link">
  实验2-进程创建与进程间通信
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab3.html" class="nav-link">
  实验3-进程调度算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab4.html" class="nav-link">
  实验4-存储管理算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab5.html" class="nav-link">
  实验5-文件管理系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab6.html" class="nav-link">
  实验6-网络编程(暂定)
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DragonOS" class="dropdown-title"><span class="title">DragonOS</span> <span class="arrow down"></span></button> <button type="button" aria-label="DragonOS" class="mobile-dropdown-title"><span class="title">DragonOS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          实验教程
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/DragonOS/Lab/Lab1.html" class="nav-link">
  实验-文件系统
</a></li></ul></li><li class="dropdown-item"><h4>
          课程练习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  实验-文件系统
</a></li></ul></li><li class="dropdown-item"><h4>
          附录
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/DragonOS/Appendix/Lab1.html" class="nav-link">
  实验-文件系统
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/OS_lab_tutorial/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow down"></span></button> <button type="button" aria-label="Linux" class="mobile-dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          实验教程
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab1.html" class="nav-link">
  实验1-熟悉类Linux系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab2.html" class="nav-link">
  实验2-进程创建与进程间通信
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab3/" class="nav-link">
  实验3-进程调度算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab4/" class="nav-link">
  实验4-存储管理算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab5.html" class="nav-link">
  实验5-文件管理系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Lab/Lab6.html" class="nav-link">
  实验6-网络编程(暂定)
</a></li></ul></li><li class="dropdown-item"><h4>
          课程练习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab1.html" class="nav-link">
  实验1-熟悉类Linux系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab2.html" class="nav-link">
  实验2-进程创建与进程间通信
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab3.html" class="nav-link">
  实验3-进程调度算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab4.html" class="nav-link">
  实验4-存储管理算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab5.html" class="nav-link">
  实验5-文件管理系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Assignment/Lab6.html" class="nav-link">
  实验6-网络编程(暂定)
</a></li></ul></li><li class="dropdown-item"><h4>
          附录
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab1.html" class="nav-link">
  实验1-熟悉类Linux系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab2.html" class="nav-link">
  实验2-进程创建与进程间通信
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab3.html" class="nav-link">
  实验3-进程调度算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab4.html" class="nav-link">
  实验4-存储管理算法
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab5.html" class="nav-link">
  实验5-文件管理系统
</a></li><li class="dropdown-subitem"><a href="/OS_lab_tutorial/Linux/Appendix/Lab6.html" class="nav-link">
  实验6-网络编程(暂定)
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DragonOS" class="dropdown-title"><span class="title">DragonOS</span> <span class="arrow down"></span></button> <button type="button" aria-label="DragonOS" class="mobile-dropdown-title"><span class="title">DragonOS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          实验教程
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/DragonOS/Lab/Lab1.html" class="nav-link">
  实验-文件系统
</a></li></ul></li><li class="dropdown-item"><h4>
          课程练习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  实验-文件系统
</a></li></ul></li><li class="dropdown-item"><h4>
          附录
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OS_lab_tutorial/DragonOS/Appendix/Lab1.html" class="nav-link">
  实验-文件系统
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>文件系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#补写代码" class="sidebar-link">补写代码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#创建文件" class="sidebar-link">创建文件</a></li><li class="sidebar-sub-header"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#文件读写" class="sidebar-link">文件读写</a></li></ul></li><li><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#实现-myramfs" class="sidebar-link">实现 myramfs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#open和close" class="sidebar-link">open和close</a></li><li class="sidebar-sub-header"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#fopen" class="sidebar-link">fopen</a></li></ul></li><li><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#测试文件系统" class="sidebar-link">测试文件系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#创建测试文件夹" class="sidebar-link">创建测试文件夹</a></li><li class="sidebar-sub-header"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#配置文件" class="sidebar-link">配置文件</a></li></ul></li><li><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#配置dadk" class="sidebar-link">配置dadk</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#拷贝文件-2" class="sidebar-link">拷贝文件</a></li><li class="sidebar-sub-header"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#更改dadk内容" class="sidebar-link">更改dadk内容</a></li></ul></li><li><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#挂载文件系统" class="sidebar-link">挂载文件系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#导入" class="sidebar-link">导入</a></li><li class="sidebar-sub-header"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#创建文件夹、实例并挂载" class="sidebar-link">创建文件夹、实例并挂载</a></li><li class="sidebar-sub-header"><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#迁移伪文件系统的inode" class="sidebar-link">迁移伪文件系统的inode</a></li></ul></li><li><a href="/OS_lab_tutorial/DragonOS/Assignment/Lab1.html#开始测试" class="sidebar-link">开始测试</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="文件系统"><a href="#文件系统" class="header-anchor">#</a> 文件系统</h1> <h2 id="补写代码"><a href="#补写代码" class="header-anchor">#</a> 补写代码</h2> <h3 id="创建文件"><a href="#创建文件" class="header-anchor">#</a> 创建文件</h3> <p>ramfs的基本功能在/kernel/src/filesystem/ramfs/mod.rs中，实现过程中请参考文件../vfs/mod.rs以及已实现函数的相关代码和注释。在实现基本的文件操作之前，需要先实现创建文件结构的辅助函数：create_with_data。其用于创建文件时，在父目录下创建带初始化数据的inode。</p> <blockquote><p>练习1：实现位于/kernel/src/filesystem/ramfs/mod.rs中的 create_with_data。</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code>    <span class="token comment">// 该函数用于在当前目录下创建一个新的inode，并传入一个简单的data字段，方便进行初始化。</span>
    <span class="token comment">// 需要判断当前inode是否是文件且是否重名，接着创建inode进行初始化。</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">create_with_data</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span>
        file_type<span class="token punctuation">:</span> <span class="token class-name">FileType</span><span class="token punctuation">,</span>
        mode<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
        data<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">IndexNode</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">SystemError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取当前inode</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> inode <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// LAB TODO BEGIN</span>

        <span class="token comment">// LAB TODO END</span>

        <span class="token comment">// 初始化inode的自引用的weak指针</span>
        result<span class="token number">.0</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>self_ref <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">downgrade</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 将子inode插入父inode的B树中</span>
        inode<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="文件读写"><a href="#文件读写" class="header-anchor">#</a> 文件读写</h3> <p>文件读写是文件系统的基本功能，ramfs的读写操作会将文件数据块中内容读入内存缓冲区，或将缓冲区内容写入对应文件数据块。<code>read_at</code>和 <code>write_at</code>两个函数分别用于以一定偏移量读取和写入一段长度的数据，并且返回实际的读写字节长度 （读取不能超过文件大小）</p> <blockquote><p>练习2：实现位于/kernel/src/filesystem/ramfs/mod.rs中的 read_at和 write_at。</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code>    <span class="token comment">// 该函数用于实现对文件以一定偏移量读取一段长度的数据，并且返回实际的读字节长度。</span>
    <span class="token comment">// 首先检查当前inode是否为一个文件，然后计算读文件的偏移量，最后拷贝数据（copy_from_slice）。</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">read_at</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span>
        offset<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>
        len<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>
        buf<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        _data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">FilePrivateData</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token class-name">SystemError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> buf<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> len <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">SystemError</span><span class="token punctuation">::</span><span class="token constant">EINVAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 加锁</span>
        <span class="token keyword">let</span> inode<span class="token punctuation">:</span> <span class="token class-name">SpinLockGuard</span><span class="token operator">&lt;</span><span class="token class-name">RamFSInode</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// LAB TODO BEGIN</span>

        <span class="token comment">// LAB TODO END</span>

        <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 该函数用于实现对文件以一定偏移量写一段长度的数据，并且返回实际的写字节长度。</span>
    <span class="token comment">// 首先检查当前inode是否为一个文件，如果文件大小比原来的大，那就resize这个数组，最后将数据写入（copy_from_slice）。</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">write_at</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span>
        offset<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>
        len<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>
        buf<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        _data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">FilePrivateData</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token class-name">SystemError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> buf<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> len <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">SystemError</span><span class="token punctuation">::</span><span class="token constant">EINVAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 加锁</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> inode<span class="token punctuation">:</span> <span class="token class-name">SpinLockGuard</span><span class="token operator">&lt;</span><span class="token class-name">RamFSInode</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 检查当前inode是否为一个文件夹，如果是的话，就返回错误</span>
        <span class="token keyword">if</span> inode<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>file_type <span class="token operator">==</span> <span class="token class-name">FileType</span><span class="token punctuation">::</span><span class="token class-name">Dir</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">SystemError</span><span class="token punctuation">::</span><span class="token constant">EISDIR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// LAB TODO BEGIN</span>

        <span class="token comment">// LAB TODO END</span>

        <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="实现-myramfs"><a href="#实现-myramfs" class="header-anchor">#</a> 实现 myramfs</h2> <blockquote><p>练习3：模仿 ramfs 实现 my_ramfs，并更正 ramfs</p></blockquote> <p>原 ramfs 其实是有点小问题的，需要在 my_ramfs 更正后再测试，具体如下：</p> <h3 id="open和close"><a href="#open和close" class="header-anchor">#</a> open和close</h3> <p>测试代码中打开文件调用的<code>open</code>函数，最终会进行系统调用，在 <strong>kernel/src/syscall</strong> 中，标志是<code>SYS_OPEN</code></p> <p><img src="/OS_lab_tutorial/assets/img/SYS_OPEN.cfa2f73d.png" alt="图片1"></p> <p>检查文件路径正确后会调用同级目录下的 <strong>syscall.rs</strong> 中的 open 函数</p> <p>测试代码中的关闭文件调用<code>close</code>函数也和 open 类似，标志为<code>SYS_CLOSE</code>，然后调用 <strong>syscall.rs</strong> 中的 close 函数</p> <p><img src="/OS_lab_tutorial/assets/img/SYS_CLOSE.f0ca2b28.png" alt="图片2"></p> <p>再看 <strong>kernel/vfs/mod.rs</strong> 的<code>IndexNode</code>接口中</p> <p><img src="/OS_lab_tutorial/assets/img/IndexNode_open_and_close.3c0f2f59.png" alt="图片3"></p> <p>如果文件系统没有具体实现 open 和 close 函数，就返回不支持，所以这就是出错的原因</p> <p><strong>解决方式：</strong></p> <p>在我们模仿的 ramfs 文件系统里，添加 open 和 close 函数的具体实现，如下：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">open</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> _data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">FilePrivateData</span><span class="token punctuation">,</span> _mode<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">super</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>vfs<span class="token punctuation">::</span>file<span class="token punctuation">::</span></span><span class="token class-name">FileMode</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SystemError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">close</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> _data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">FilePrivateData</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SystemError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="fopen"><a href="#fopen" class="header-anchor">#</a> fopen</h3> <p>测试代码中我们用到了<code>fopen</code>来打开文件，第二个参数的&quot;w+&quot;的含义可以在 <strong>user/libs/libc/src/stdio.c</strong> 文件中查看，表示读写文件，并且如果文件不存在的话就创建这个文件</p> <p>fopen 的系统调用也是 SYS_OPEN ，但是和 open 的区别在于：</p> <p><img src="/OS_lab_tutorial/assets/img/SYS_OPEN_truncate.3958a8e0.png" alt="图片4"></p> <p>fopen 在满足条件的情况下会调用<code>truncate</code>函数，这个函数和 open 、close 一样，也是定义在 <strong>vfs/mod.rs</strong> 中的 IndexNode 接口中，但是没有具体实现，需要文件系统自己实现，如下：</p> <p><img src="/OS_lab_tutorial/assets/img/truncate.0e0496b9.png" alt="图片5"></p> <p><strong>解决方式：</strong></p> <p>所以需要在我们模仿的 ramfs 中，添加 truncate 的具体实现，如下：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">truncate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> _len<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SystemError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> inode <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> inode<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>file_type <span class="token operator">==</span> <span class="token class-name">FileType</span><span class="token punctuation">::</span><span class="token class-name">Dir</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">SystemError</span><span class="token punctuation">::</span><span class="token constant">EISDIR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    inode<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>_len<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="测试文件系统"><a href="#测试文件系统" class="header-anchor">#</a> 测试文件系统</h2> <p>测试我们模仿实现的 my_ramfs</p> <h3 id="创建测试文件夹"><a href="#创建测试文件夹" class="header-anchor">#</a> 创建测试文件夹</h3> <p>在 <strong>DragonOS/user/apps</strong> 目录下新建一个文件夹 <strong>my_test</strong></p> <h3 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h3> <h4 id="拷贝文件"><a href="#拷贝文件" class="header-anchor">#</a> 拷贝文件</h4> <p>找到 <strong>DragonOS/user/apps</strong> 目录下其他测试文件夹（例如：test_fstat）的两个文件：<strong>link.lds</strong> + <strong>Makefile</strong>，将这两个文件拷贝到我们新建的测试文件夹 <strong>my_test</strong> 中</p> <h4 id="更改makefile内容"><a href="#更改makefile内容" class="header-anchor">#</a> 更改Makefile内容</h4> <p>将 <strong>Makefile</strong> 中的测试目录名改回来，假设拷贝的是 test_fstat 目录的，则按如下修改：</p> <h4 id="test-fstat-makefile"><a href="#test-fstat-makefile" class="header-anchor">#</a> test_fstat/Makefile</h4> <p><img src="/OS_lab_tutorial/assets/img/test_fstat_Makefile.3d4af40a.png" alt="图片6"></p> <h4 id="my-test-makefile"><a href="#my-test-makefile" class="header-anchor">#</a> my_test/Makefile</h4> <p><img src="/OS_lab_tutorial/assets/img/my_test_Makefile.b350a9ab.png" alt="图片7"></p> <p>将代码里的 <strong>test_fstat</strong> 改为 <strong>my_test</strong>（<strong>PS:</strong> 注意区分大小写）</p> <h2 id="配置dadk"><a href="#配置dadk" class="header-anchor">#</a> 配置dadk</h2> <h3 id="拷贝文件-2"><a href="#拷贝文件-2" class="header-anchor">#</a> 拷贝文件</h3> <p>在 <strong>DragonOS/user/dadk/config</strong> 目录下模仿其它文件新建一个文件 <strong>my_test-0.1.0.dadk</strong>（<strong>PS:</strong> 这里的my_test和我们在第一步创建的测试目录名相同），然后拷贝其他文件的内容到里面，比如拷贝 <strong>test_fstat-0.1.0.dadk</strong></p> <h3 id="更改dadk内容"><a href="#更改dadk内容" class="header-anchor">#</a> 更改dadk内容</h3> <p>还是和之前类似，按如下修改：</p> <h4 id="test-fstat-0-1-0-dadk"><a href="#test-fstat-0-1-0-dadk" class="header-anchor">#</a> <strong>test_fstat-0.1.0.dadk</strong></h4> <p><img src="/OS_lab_tutorial/assets/img/test_fstat_dadk.36262698.png" alt="图片8"></p> <h4 id="my-test-0-1-0-dadk"><a href="#my-test-0-1-0-dadk" class="header-anchor">#</a> <strong>my_test-0.1.0.dadk</strong></h4> <p><img src="/OS_lab_tutorial/assets/img/my_test_dadk.e19abbf2.png" alt="图片9"></p> <p>将代码里的 <strong>test_fstat</strong> 都改成 <strong>my_test</strong></p> <h2 id="挂载文件系统"><a href="#挂载文件系统" class="header-anchor">#</a> 挂载文件系统</h2> <p>将你要测试的文件系统挂载到我们的操作系统上面</p> <p>打开 <strong>DragonOS/kernel/src/filesystem/vfs/core.rs</strong> 文件</p> <h3 id="导入"><a href="#导入" class="header-anchor">#</a> 导入</h3> <p>导入你自己实现的文件系统，比如我这里是模仿ramfs写了一个my_ramfs，就按如下添加：</p> <p><img src="/OS_lab_tutorial/assets/img/crate_my_ramfs.e8b6b5ee.png" alt="图片10"></p> <h3 id="创建文件夹、实例并挂载"><a href="#创建文件夹、实例并挂载" class="header-anchor">#</a> 创建文件夹、实例并挂载</h3> <p>在<code>vfs_init</code>函数中：</p> <p>模仿其它文件系统创建当前准备测试的文件系统的文件夹，如下：</p> <p><img src="/OS_lab_tutorial/assets/img/vfs_init_mkdir.f7109679.png" alt="图片11"></p> <p>紧接着在下面创建 ramfs 实例，并挂载，照样是模仿其它文件系统挂载，如下：</p> <p><img src="/OS_lab_tutorial/assets/img/vfs_init_mount.1283c085.png" alt="图片12"></p> <h3 id="迁移伪文件系统的inode"><a href="#迁移伪文件系统的inode" class="header-anchor">#</a> 迁移伪文件系统的inode</h3> <p>在 <strong>migrate_virtual_filesystem</strong> 函数中：</p> <h4 id="获取inode"><a href="#获取inode" class="header-anchor">#</a> 获取inode</h4> <p>模仿其它文件系统获取ramfs的inode，如下：</p> <p><img src="/OS_lab_tutorial/assets/img/binding.685af1e7.png" alt="图片13"></p> <h4 id="迁移到新的文件系统下"><a href="#迁移到新的文件系统下" class="header-anchor">#</a> 迁移到新的文件系统下</h4> <p><img src="/OS_lab_tutorial/assets/img/do_migrate.eb102e71.png" alt="图片14"></p> <h2 id="开始测试"><a href="#开始测试" class="header-anchor">#</a> 开始测试</h2> <p>至此，我们就可以开始测试文件系统了。</p> <p>在之前我们新建的测试文件夹 <strong>DragonOS/user/apps/my_test</strong> 目录下添加 <strong>main.c</strong> 文件，用来测试文件系统的开、关、读、写</p> <p>测试的过程中会出现一些问题，具体原因在上文的 <strong>ramfs的更正</strong> 中</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//需要先创建文件夹</span>
    <span class="token keyword">int</span> check<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    check <span class="token operator">=</span> <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">&quot;/ram/test_0&quot;</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>check<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot create dir: /ram/test_0\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    check<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    check <span class="token operator">=</span> <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">&quot;/ram/test_1&quot;</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>check<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot create dir: /ram/test_1\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//测试open+close+write+read</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Test open/close/write/read\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> fd<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;/ram/test_0/file_0.txt&quot;</span><span class="token punctuation">,</span>O_WRONLY <span class="token operator">|</span> O_CREAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Open file failed!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;File opened successfully!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> write_ptr <span class="token operator">=</span> <span class="token string">&quot;Write str here&quot;</span><span class="token punctuation">;</span>
    <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>write_ptr<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>write_ptr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Having written:%s\n&quot;</span><span class="token punctuation">,</span>write_ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;File closed successfully!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//测试open+close+read</span>
    fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;/ram/test_0/file_0.txt&quot;</span><span class="token punctuation">,</span>O_WRONLY <span class="token operator">|</span> O_CREAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Open file failed!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;File opened successfully!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Having read:%s\n&quot;</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;File closed successfully!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//测试fopen+fclose+fputs</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\nTest fopen/fclose/fputs/fgets\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FILE<span class="token operator">*</span> file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;/ram/test_1/file_0.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;w+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Fopen file failed!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;File opened successfully!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> fputs_ptr <span class="token operator">=</span> <span class="token string">&quot;Fputs str here&quot;</span><span class="token punctuation">;</span>
    <span class="token function">fputs</span><span class="token punctuation">(</span>fputs_ptr<span class="token punctuation">,</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Having fput: %s\n&quot;</span><span class="token punctuation">,</span>fputs_ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;File closed successfully!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//测试fopen+fclose+fgets</span>
    file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;/ram/test_1/file_0.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;r+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>file<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Fopen file failed!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">char</span><span class="token operator">*</span> buf1<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">fgets</span><span class="token punctuation">(</span>buf1<span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Having got: %s\n&quot;</span><span class="token punctuation">,</span>buf1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;File closed successfully!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/OS_lab_tutorial/assets/js/app.548e512b.js" defer></script><script src="/OS_lab_tutorial/assets/js/2.a10c1015.js" defer></script><script src="/OS_lab_tutorial/assets/js/1.2eb350fb.js" defer></script><script src="/OS_lab_tutorial/assets/js/11.c9b949dd.js" defer></script>
  </body>
</html>
